{% extends "management_base.html" %} {% load static %} {% block subcontent %}
<div class="container">

  <div class="py-5">
    <div class="card">
      <div class="card-header" style="text-align: center">Im√≥vel</div>
      <div class="card-body">
        <form id="asset-form" action="{% url 'management:asset-archive' %}">
          {% csrf_token %}
          <select
            id="asset"
            data-url="{% url 'management:asset' %}"
            name="asset"
            class="form-select"
            aria-label="select"
            style="text-align: center"
          >
            {% for asset in assets %}
                {% if selected_asset.id == asset.id %}
                <option value="{{asset.id}}" selected>{{asset}}</option>
                {% else %}
                <option value="{{asset.id}}">{{asset}}</option>
                {% endif %} {% endfor %}
          </select>
        </form>
      </div>
    </div>
  </div>

  <div class="container px-4" style="display: flex; flex-flow: row wrap; justify-content: center; overflow: scroll; max-height: 600px;">
    {% for archive in selected_asset.archives.all %}
        {% if archive.file_type == 'image' %}
        <div class="video-box">
          <img
            class="video-box-poster"
            src="{{archive.file.url}}"
            alt=""
          >
          <div
          class="video-box-overlay image-overlay"
          data-media-src="{{archive.file.url}}"
          data-media-title="{{archive.title}}"
          data-media-description="{{archive.description}}"
          >
          </div>
        </div>
        {% else %}
        <div class="video-box">
          <img
            class="video-box-poster"
            src="{{archive.poster.url}}"
            alt=""
          />
          <div
            class="video-box-overlay video-overlay"
            data-media-src="{{archive.file.url}}"
            data-media-title="{{archive.title}}"
            data-media-description="{{archive.description}}"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="overlay--play-button"
              width="32"
              height="32"
              fill="currentColor"
              class="bi bi-play-btn-fill"
              viewBox="0 0 16 16"
            >
              <path
                d="M0 12V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2m6.79-6.907A.5.5 0 0 0 6 5.5v5a.5.5 0 0 0 .79.407l3.5-2.5a.5.5 0 0 0 0-.814z"
              />
            </svg>
          </div>
        </div>
        {% endif %}
    {% endfor %}
  </div>
</div>

<script>
  const backdrop = document.querySelector(".backdrop");
  const backdropVideo = document.querySelector('#modal-video');
  const backdropImage = document.querySelector('#backdrop-image');
  const modalCloseButton = document.querySelector(".modal-close-button");
  const imageOverlay = document.querySelector(".image-overlay");
  const videoOverlay = document.querySelector(".video-overlay");

  modalCloseButton.addEventListener("click", closeModalButtonHandler);
  imageOverlay.addEventListener("click", displayImageModalHandler);
  videoOverlay.addEventListener("click", displayVideoModalHandler);

  function closeModalButtonHandler() {
    backdrop.style.display = "none";
    backdropImage.src = "";
    backdropVideo.src = "";
    backdropVideo.style.display = 'none';
    backdropImage.style.display = 'none';
  }

  function backdropHandler() {
    if (backdrop.style.display === "none" || backdrop.style.display === "") {
      backdrop.style.display = "flex";
    } else {
      backdrop.style.display = "none";
    }
  }

  async function showVideo(src) {
    backdropVideo.src = src;
    backdropVideo.style.display = 'block';
  }

  function displayImageModalHandler (url, title, description) {
    backdropHandler();
    let mediaSrc = this.dataset.mediaSrc;
    let mediaTitle = this.dataset.mediaTitle;
    let mediaDescription = this.dataset.mediaDescription;
    backdropImage.src = mediaSrc;

  }

  function displayVideoModalHandler(url, title, description) {
    backdropHandler();
    let mediaSrc = this.dataset.mediaSrc;
    let mediaTitle = this.dataset.mediaTitle;
    let mediaDescription = this.dataset.mediaDescription;
    showVideo(mediaSrc);
  }
</script>
{% endblock subcontent %}
